document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",m);var c,u;function m(t){c=t.target.closest("[data-delete-route]"),c&&(t.preventDefault(),u=c.dataset.deleteRoute)}document.getElementById("confirmDeleteBtn").addEventListener("click",()=>{f()});function f(){fetch(u,{method:"delete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).then(t=>t.json()).then(t=>{t.error==!0?toastr.error(t.message,"Admin Panel"):toastr.success(t.message,"Admin Panel")}),c.parentElement.parentElement.parentElement.remove()}document.addEventListener("click",function(t){const o=t.target.closest("[data-row-data]");if(!o)return;t.preventDefault();const e=o.dataset.updateRoute,r=JSON.parse(o.dataset.rowData);let n;o.dataset.selectOptions&&(n=JSON.parse(o.dataset.selectOptions)),document.getElementById("updateDataForm").setAttribute("action",e),Array.from(document.querySelectorAll(".updateDataField")).forEach((s,i)=>{s.value=r[i]}),Array.from(document.querySelectorAll(".selectOptions")).forEach((s,i)=>{for(;s.firstChild;)s.removeChild(s.firstChild);if(n[i].length>0)n[i].forEach(l=>{const d=document.createElement("option");d.value=l.id,d.textContent=l.name,s.appendChild(d)});else{const l=document.createElement("option");l.value="",l.textContent="No topics found for this category!",s.appendChild(l)}})}),$("form").submit(function(t){$("#loading").toggleClass("d-none"),$("body").css("overflow","hidden"),t.preventDefault();const o=$(this),e=o.attr("action"),r=o.attr("method"),n=new FormData(this);$.ajax({url:e,type:r,data:n,contentType:!1,processData:!1,success:function(a){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),a.error==!0?toastr.error(a.message,"Admin Panel"):(toastr.success(a.message,"Admin Panel"),o.parents(".modal").length>0&&o[0].reset(),$(".modal").modal("hide"),$(".dataTable").DataTable().draw())},error:function(a){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),console.error("Error:",a)}})}),$(".modal").on("hidden.coreui.modal",function(){$(this).find("form").trigger("reset")}),$("[data-table-route]").each(function(t){const e=$(this).attr("data-table-route"),r=$(this).find("th").map(function(n,a){return{data:$(this).text()==="#"?"serial":$(this).text()==="Category"?"category.title":$(this).text()==="Topic"?"topic.name":$(this).text()==="Categories"?"categories_names":$(this).text().toLowerCase(),name:$(this).text(),searchable:$(this).text()!=="#"&&$(this).text()!=="Actions",orderable:$(this).text()!=="Actions",defaultContent:"NA"}});$("[data-table-route]").DataTable({language:{zeroRecords:"No record(s) found."},processing:!0,serverSide:!0,lengthChange:!0,order:[0,"asc"],searchable:!0,bStateSave:!1,ajax:{url:e,data:function(n){}},columns:r})}),$(document).on("click","[data-btn-route]",function(t){const o=$(this).data("btn-route");fetch(o).then(e=>e.json()).then(e=>{e.error==!0?toastr.error(e.message,"Admin Panel"):toastr.success(e.message,"Admin Panel")})}),$("#categoryPostCategory").on("change",function(){const o=$(this).find("option:selected").data("topics-route"),e=document.getElementById("categoryPostTopic");for(;e.firstChild;)e.removeChild(e.firstChild);fetch(o).then(r=>r.json()).then(r=>{if(r.length>0)r.forEach(n=>{const a=document.createElement("option");a.value=n.id,a.textContent=n.name,e.appendChild(a)});else{const n=document.createElement("option");n.value="",n.textContent="No topics found for this category!",e.appendChild(n)}})})});
