document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",p);var l,u;function p(t){l=t.target.closest("[data-delete-route]"),l&&(t.preventDefault(),u=l.dataset.deleteRoute)}const m=document.getElementById("confirmDeleteBtn");m&&m.addEventListener("click",()=>{h()});const f=document.getElementById("confirmDemoteBtn");f&&f.addEventListener("click",()=>{console.log("h"),h()});function h(){fetch(u,{method:"delete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).then(t=>t.json()).then(t=>{t.error==!0?toastr.error(t.message,"Admin Panel"):toastr.success(t.message,"Admin Panel")}),l.parentElement.parentElement.parentElement.remove()}document.addEventListener("click",function(t){const e=t.target.closest("[data-row-data]")||t.target.closest("[data-restricted-permissions]");if(!e)return;t.preventDefault();const o=e.dataset.updateRoute;let s;e.dataset.rowData&&(s=JSON.parse(e.dataset.rowData));let n;e.dataset.selectOptions&&(n=JSON.parse(e.dataset.selectOptions));let a;e.dataset.restrictedPermissions&&(a=JSON.parse(e.dataset.restrictedPermissions)),document.getElementById("updateDataForm").setAttribute("action",o),Array.from(document.querySelectorAll(".updateDataField")).forEach((r,c)=>{r.value=s[c]}),Array.from(document.querySelectorAll(".selectOptions")).forEach((r,c)=>{for(;r.firstChild;)r.removeChild(r.firstChild);if(n[c].length>0)n[c].forEach(i=>{const d=document.createElement("option");d.value=i.id,d.textContent=i.name,r.appendChild(d)});else{const i=document.createElement("option");i.value="",i.textContent="No topics found for this category!",r.appendChild(i)}}),a&&Array.from(document.querySelectorAll(".permissionCheckBox")).forEach((r,c)=>{r.checked=!a.includes(parseInt(r.value))})}),$("form").on("submit",function(t){$("#loading").toggleClass("d-none"),$("body").css("overflow","hidden"),t.preventDefault();const e=$(this),o=e.attr("action"),s=e.attr("method"),n=new FormData(this);$.ajax({url:o,type:s,data:n,contentType:!1,processData:!1,success:function(a){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),a.error==!0?toastr.error(a.message,"Admin Panel"):(toastr.success(a.message,"Admin Panel"),e.parents(".modal").length>0&&(e[0].reset(),document.querySelectorAll('form input[type="hidden"]').forEach(r=>{r.name!=="_token"&&(r.value="")})),$(".modal").modal("hide"),$(".dataTable").DataTable().draw())},error:function(a){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),toastr.error("Something went wrong!","Admin Panel"),console.error("Error:",a)}})}),$(".modal").on("hide.coreui.modal",function(){$(this).find("form").trigger("reset"),document.querySelectorAll('form input[type="hidden"]').forEach(e=>{e.name!=="_token"&&(e.value="")})}),$("[data-table-route]").each(function(t){const o=$(this).attr("data-table-route"),s=$(this).find("th").map(function(n,a){return{data:$(this).text()==="#"?"serial":$(this).text()==="Category"?"category_title":$(this).text()==="Group"?"group_title":$(this).text()==="Topic"?"topic_name":$(this).text()==="Categories"?"categories_names":$(this).text()==="Media"?"media_file":$(this).text().toLowerCase(),name:$(this).text(),searchable:$(this).text()!=="#"&&$(this).text()!=="Actions",orderable:$(this).text()!=="Actions",defaultContent:"NA"}});$("[data-table-route]").DataTable({language:{zeroRecords:"No record(s) found."},processing:!0,serverSide:!0,lengthChange:!0,order:[0,"asc"],searchable:!0,bStateSave:!1,ajax:{url:o,data:function(n){}},columns:s})}),$(document).on("click","[data-btn-route]",function(t){const e=$(this).data("btn-route");fetch(e).then(o=>o.json()).then(o=>{o.error==!0?toastr.error(o.message,"Admin Panel"):toastr.success(o.message,"Admin Panel")})}),$("#categoryPostCategory").on("change",function(){const e=$(this).find("option:selected").data("topics-route"),o=document.getElementById("categoryPostTopic");for(;o.firstChild;)o.removeChild(o.firstChild);fetch(e).then(s=>s.json()).then(s=>{if(s.length>0)s.forEach(n=>{const a=document.createElement("option");a.value=n.id,a.textContent=n.name,o.appendChild(a)});else{const n=document.createElement("option");n.value="",n.textContent="No topics found for this category!",o.appendChild(n)}})})});
