import{$ as n,t as d}from"./toastr-19c08aa3.js";import{l as h,X as g,H as y}from"./tw-elements.es.min-563fcd5f.js";import"./_commonjsHelpers-23102255.js";h({Dropdown:g,Ripple:y});var t=n.noConflict();document.addEventListener("DOMContentLoaded",function(){t(document).on("submit","#create-post-modal form",function(o){o.preventDefault();var e=t(this),a=e.attr("action"),s=e.attr("method"),i=e.find('button[type="submit"]');i.html('<i class="fas fa-2x fa-sync-alt fa-spin"></i>');var c=new FormData(this);t.ajax({url:a,type:s,data:c,processData:!1,contentType:!1,success:function(r){var l;if(i.html("Save changes"),t("#create-post-modal form")[0].reset(),(l=window.FlowbiteInstances.getInstance("Modal","create-post-modal"))==null||l.hide(),r.data.error==!0)return d.error(r.data.message),!1;t("#post-list").html(r.data.posts),d.success(r.data.message)},error:function(r){var l;i.html("Save changes"),t("#create-post-modal form")[0].reset(),(l=window.FlowbiteInstances.getInstance("Modal","create-post-modal"))==null||l.hide(),d.error(r.responseJSON.data.message)}})}),t(document).on("click",".create-comment-btn",function(o){var e=t(this).data("post_id");t("#hidden_post_id").val(e)}),t(document).on("submit","#comment-form",function(o){o.preventDefault();var e=t(this),a=e.attr("action");e.attr("method");var s=e.find('button[type="submit"]');s.html('<i class="fas fa-2x fa-sync-alt fa-spin"></i>');var i=new FormData(this);t.ajax({url:a,type:"POST",data:i,processData:!1,contentType:!1,success:function(c){var l;if(s.html("Save changes"),t("#comment-form")[0].reset(),(l=window.FlowbiteInstances.getInstance("Modal","create-comment-modal"))==null||l.hide(),c.error==!0)return!1;var r=i.get("post_id");t("#comment_count_"+r).html(c.data.comment_count),t("#create-post-modal").addClass("hidden")},error:function(c){s.html("Save changes");const r=c.responseJSON.message;if(console.error("Error:",r),r=="Unauthenticated.")return t("#create-new-group").hide(),Swal.fire({title:"Error!",text:"Please login to create group",icon:"error",showConfirmButton:!0}).then(l=>{}),!1}})}),t(document).on("click",".comment-list",function(o){const e=t(this).data("comments-route");t("#popup-comment-list").html('<span class="text-center">Loading...</span>'),t.ajax({url:e,type:"GET",data:{post_id:t(this).data("post_id")},success:function(a){if(a.error==!0)return Swal.fire({title:"Error!",text:a.data.message,icon:"error",showConfirmButton:!0}).then(s=>{}),console.error("Error saving post:",error.responseText),!1;t("#popup-comment-list").html(a.data.comments)},error:function(a){console.error("Error:",a.message)}})}),t(document).on("click",".like-post",function(o){const e=t(this);t.ajax({url:n(this).data("route"),type:"POST",data:{post_id:n(this).data("post_id")},headers:{"X-CSRF-TOKEN":n('meta[name="csrf-token"]').attr("content")},success:function(a){if(a.error==!0)return Swal.fire({title:"Error!",text:a.data.message,icon:"error",showConfirmButton:!0}).then(i=>{}),console.error("Error saving post:",error.responseText),!1;var s=a.data.post_id;t("#like_count_"+s).html(a.data.like_count),e.html(a.data.button)},error:function(a){console.error("Error:",errorMessage)}})}),t(document).on("click",".view-all-replies",function(o){o.preventDefault();var e=t(this).data("comment_id");t("#comment"+e+" .additional-replies").css("display","flex"),t(this).hide()}),t(document).on("click",".edit-button",function(o){var e=n(this).siblings("div").find("p").text();console.log("llllllllllllllll",n(this).data("url")),n(this).siblings("div").find("p").replaceWith('<input type="text" class="edit-field" value="'+e+'">'),n(this).siblings("div").find("input").focus(),n(this).siblings("div").find("input").get(0).setSelectionRange(e.length,e.length),n(this).html('<i class="fa-solid fa-save"></i>').addClass("save-button").removeClass("edit-button")}),t(document).on("click",".save-button",function(){n(this);var o=n(this).siblings("div").find("input").val();console.log("ssaavvee",n(this).data("url"));var e='<p class="py-2 text-sm font-normal text-gray-900 dark:text-white">'+o+"</p>";n(this).siblings("div").find("input").replaceWith(e),n(this).html('<i class="fa-solid fa-pencil"></i>').addClass("edit-button").removeClass("save-button"),n.ajax({type:"POST",url:n(this).data("url"),data:{content:o},headers:{"X-CSRF-TOKEN":n('meta[name="csrf-token"]').attr("content")},success:function(a){},error:function(a,s,i){console.error(a.responseText)}})});let m;t(document).on("click",".reply-button",function(o){const e=t(this).parent().attr("id"),a=t(this).parent().data("comment_id");if(m=t(this).parent().data("reply_route"),!t(`#replyBox${e}`).length){const s=`
        <div class="flex items-end w-11/12 gap-4 py-2" id="replyBox${e}">
          <input class="rounded-md" type="text" id="reply${e}" placeholder="Write a reply...">
          <button data-comment_id="${e}" data-comment_primary_id="${a}" class="px-3 py-2 text-white bg-blue-500 rounded-md postReply" type="button">Post</button>
        </div>
      `;t(this).siblings(".replies").append(s),setTimeout(()=>t(`#reply${e}`).focus(),0)}}),t(document).on("click",".postReply",function(o){o.preventDefault();const e=t(this).data("comment_id"),a=t(this).data("comment_primary_id");console.log(m),p(e,a)});function p(o,e){const a=n(`#reply${o}`),s=n(`#replyBox${o}`),i=a.val();console.log(m),s.remove(),n.ajax({type:"POST",url:m,data:{content:i,commentId:e},headers:{"X-CSRF-TOKEN":n('meta[name="csrf-token"]').attr("content")},success:function(c){const r=f(i,c.data.update_url);n(`#${o} .replies`).append(r)},error:function(){alert("Error posting reply. Please try again.")}})}function f(o,e){const a=n("#userImg").attr("src"),s=n("#userName").text();return`
        <div class="flex items-start w-11/12 gap-2 ml-auto reply">
            <img class="w-8 h-8 rounded-full" src="${a}" alt="{{ auth()->user()->name }} image">
            <div class="flex flex-col w-full leading-1.5 px-4 py-2 border-gray-200 bg-gray-100 max-w-[320px] rounded-e-xl rounded-es-xl dark:bg-gray-700">
                <div class="flex items-center space-x-2 rtl:space-x-reverse">
                    <span class="text-sm font-semibold text-gray-900 dark:text-white">${s}</span>
                    <span class="text-sm font-normal text-gray-500 dark:text-gray-400">Now</span>
                </div>
                <p class="py-2 text-sm font-normal text-gray-900 dark:text-white">${o}</p>
            </div>
            <button data-url="${e}" class="inline-flex items-center self-center p-2 text-sm font-medium text-center text-gray-900 bg-white rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none dark:text-white focus:ring-gray-50 dark:bg-gray-900 dark:hover:bg-gray-800 dark:focus:ring-gray-600 edit-button" type="button">
                <i class="fa-solid fa-pencil"></i>
            </button>
        </div>
    `}const u=async function(o,e){const a=o.data("route"),s=o.data(`${e}_id`);if(!a)throw new Error("Route is missing");const i={method:"DELETE",headers:{"X-CSRF-TOKEN":n('meta[name="csrf-token"]').attr("content")}},c=await fetch(a,i),r=await c.json();c.ok?(d.success(r.message),n(`#${e}${s}`).remove()):d.error(r.message)};t(document).on("click",".deletePost",async function(o){await u(t(this),"post")}),t(document).on("click",".deleteComment",async function(o){await u(t(this),"comment")}),t(document).on("click",".deleteReply",async function(o){await u(t(this),"reply")}),t(document).on("click",".muteUser",async function(o){const e=t(this).data("route"),a=await fetch(e),s=await a.json();a.ok?d.success(s.message):d.error(s.message)})});
