document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",u);var l,d;function u(o){l=o.target.closest("[data-delete-route]"),l&&(o.preventDefault(),d=l.dataset.deleteRoute)}document.getElementById("confirmDeleteBtn").addEventListener("click",()=>{m()});function m(){fetch(d).then(o=>o.json()).then(o=>{o.error==!0?toastr.error(o.message,"Admin Panel"):toastr.success(o.message,"Admin Panel")}),l.parentElement.parentElement.parentElement.remove()}document.addEventListener("click",function(o){const n=o.target.closest("[data-row-data]");if(!n)return;o.preventDefault();const t=n.dataset.updateRoute,r=JSON.parse(n.dataset.rowData);n.dataset.selectOptions&&JSON.parse(n.dataset.selectOptions),document.getElementById("updateDataForm").setAttribute("action",t),Array.from(document.querySelectorAll(".updateDataField")).forEach((e,c)=>{e.value=r[c]}),Array.from(document.querySelectorAll(".selectOptions")).forEach((e,c)=>{for(;e.firstChild;)e.removeChild(e.firstChild);if(selectOptionsData[c].length>0)selectOptionsData[c].forEach(s=>{const i=document.createElement("option");i.value=s.id,i.textContent=s.name,e.appendChild(i)});else{const s=document.createElement("option");s.value="",s.textContent="No topics found for this category!",e.appendChild(s)}})}),$("form").submit(function(o){$("#loading").toggleClass("d-none"),$("body").css("overflow","hidden"),o.preventDefault();const n=$(this),t=n.attr("action"),r=n.attr("method"),a=new FormData(this);$.ajax({url:t,type:r,data:a,contentType:!1,processData:!1,success:function(e){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),e.error==!0?toastr.error(e.message,"Admin Panel"):(toastr.success(e.message,"Admin Panel"),n.parents(".modal").length>0&&n[0].reset(),$(".modal").modal("hide"),$(".dataTable").DataTable().draw())},error:function(e){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),console.error("Error:",e)}})}),$(".modal").on("hidden.coreui.modal",function(){$(this).find("form").trigger("reset")}),$("[data-table-route]").each(function(o){const t=$(this).attr("data-table-route"),r=$(this).find("th").map(function(a,e){return{data:$(this).text()==="#"?"serial":$(this).text()==="Category"?"category.title":$(this).text()==="Topic"?"topic.name":$(this).text()==="Categories"?"categories_names":$(this).text().toLowerCase(),name:$(this).text(),searchable:$(this).text()!=="#"&&$(this).text()!=="Actions",orderable:$(this).text()!=="Actions",defaultContent:"NA"}});$("[data-table-route]").DataTable({language:{zeroRecords:"No record(s) found."},processing:!0,serverSide:!0,lengthChange:!0,order:[0,"asc"],searchable:!0,bStateSave:!1,ajax:{url:t,data:function(a){}},columns:r})}),$(document).on("click","[data-btn-route]",function(o){const n=$(this).data("btn-route");fetch(n).then(t=>t.json()).then(t=>{t.error==!0?toastr.error(t.message,"Admin Panel"):toastr.success(t.message,"Admin Panel")})}),$("#categoryPostCategory").on("change",function(){const n=$(this).find("option:selected").data("topics-route"),t=document.getElementById("categoryPostTopic");for(;t.firstChild;)t.removeChild(t.firstChild);fetch(n).then(r=>r.json()).then(r=>{if(r.length>0)r.forEach(a=>{const e=document.createElement("option");e.value=a.id,e.textContent=a.name,t.appendChild(e)});else{const a=document.createElement("option");a.value="",a.textContent="No topics found for this category!",t.appendChild(a)}})})});
