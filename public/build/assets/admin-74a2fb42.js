document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",m);var c,u;function m(t){c=t.target.closest("[data-delete-route]"),c&&(t.preventDefault(),u=c.dataset.deleteRoute)}document.getElementById("confirmDeleteBtn").addEventListener("click",()=>{h()});function h(){fetch(u,{method:"delete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).then(t=>t.json()).then(t=>{t.error==!0?toastr.error(t.message,"Admin Panel"):toastr.success(t.message,"Admin Panel")}),c.parentElement.parentElement.parentElement.remove()}document.addEventListener("click",function(t){const e=t.target.closest("[data-row-data]");if(!e)return;t.preventDefault();const o=e.dataset.updateRoute,r=JSON.parse(e.dataset.rowData);let n;e.dataset.selectOptions&&(n=JSON.parse(e.dataset.selectOptions)),document.getElementById("updateDataForm").setAttribute("action",o),Array.from(document.querySelectorAll(".updateDataField")).forEach((s,i)=>{s.value=r[i]}),Array.from(document.querySelectorAll(".selectOptions")).forEach((s,i)=>{for(;s.firstChild;)s.removeChild(s.firstChild);if(n[i].length>0)n[i].forEach(l=>{const d=document.createElement("option");d.value=l.id,d.textContent=l.name,s.appendChild(d)});else{const l=document.createElement("option");l.value="",l.textContent="No topics found for this category!",s.appendChild(l)}})}),$("form").submit(function(t){$("#loading").toggleClass("d-none"),$("body").css("overflow","hidden"),t.preventDefault();const e=$(this),o=e.attr("action"),r=e.attr("method"),n=new FormData(this);$.ajax({url:o,type:r,data:n,contentType:!1,processData:!1,success:function(a){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),a.error==!0?toastr.error(a.message,"Admin Panel"):(toastr.success(a.message,"Admin Panel"),e.parents(".modal").length>0&&(e[0].reset(),document.querySelectorAll('form input[type="hidden"]').forEach(i=>{i.name!=="_token"&&(i.value="")})),$(".modal").modal("hide"),$(".dataTable").DataTable().draw())},error:function(a){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),toastr.error("Something went wrong!","Admin Panel"),console.error("Error:",a)}})}),$(".modal").on("hide.coreui.modal",function(){$(this).find("form").trigger("reset"),document.querySelectorAll('form input[type="hidden"]').forEach(e=>{e.name!=="_token"&&(e.value="")})}),$("[data-table-route]").each(function(t){const o=$(this).attr("data-table-route"),r=$(this).find("th").map(function(n,a){return{data:$(this).text()==="#"?"serial":$(this).text()==="Category"?"category_title":$(this).text()==="Group"?"group_title":$(this).text()==="Topic"?"topic_name":$(this).text()==="Categories"?"categories_names":$(this).text()==="Media"?"media_file":$(this).text().toLowerCase(),name:$(this).text(),searchable:$(this).text()!=="#"&&$(this).text()!=="Actions",orderable:$(this).text()!=="Actions",defaultContent:"NA"}});$("[data-table-route]").DataTable({language:{zeroRecords:"No record(s) found."},processing:!0,serverSide:!0,lengthChange:!0,order:[0,"asc"],searchable:!0,bStateSave:!1,ajax:{url:o,data:function(n){}},columns:r})}),$(document).on("click","[data-btn-route]",function(t){const e=$(this).data("btn-route");fetch(e).then(o=>o.json()).then(o=>{o.error==!0?toastr.error(o.message,"Admin Panel"):toastr.success(o.message,"Admin Panel")})}),$("#categoryPostCategory").on("change",function(){const e=$(this).find("option:selected").data("topics-route"),o=document.getElementById("categoryPostTopic");for(;o.firstChild;)o.removeChild(o.firstChild);fetch(e).then(r=>r.json()).then(r=>{if(r.length>0)r.forEach(n=>{const a=document.createElement("option");a.value=n.id,a.textContent=n.name,o.appendChild(a)});else{const n=document.createElement("option");n.value="",n.textContent="No topics found for this category!",o.appendChild(n)}})})});
